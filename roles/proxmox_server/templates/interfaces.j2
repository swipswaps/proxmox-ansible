## Ansible maintained /etc/network/interfaces file.
## Don't edit /etc/network/interfaces yourself.
## Edit the template: proxmox-ansible/roles/proxmox-server/tasks/interfaces.j2

auto lo
iface lo inet loopback

auto eno1
iface eno1 inet manual
    post-up echo 1 > /proc/sys/net/ipv4/conf/eno1/proxy_arp

# br0 is the *public* network interface.
auto br0
iface br0 inet static
    # This is the static *public* ip address and gateway:
    address {{ proxmox_public_ips[0] }}
    netmask {{ proxmox_public_netmask }}
    gateway {{ proxmox_public_gateway }}
    # eno1 is the physical network interface to bridge:
    bridge_ports eno1
    bridge_stp off
    bridge_fd 0	
    bridge_maxwait 0
    post-up echo 1 > /proc/sys/net/ipv4/conf/br0/proxy_arp
    # Add additional public ip addresses if available:
    {% for ip in proxmox_public_ips[1:] %}
    post-up ip addr add {{ ip }}/{{ cidr }} brd + dev br0
    {% endfor  %}

    # On startup run the external firewall script 
    # to setup IP Masquerading and port forwards:
    post-up /etc/firewall.sh

# vmbrX are Virtual Machine subnets

{% for ip in proxmox_vmbr_ips %}
auto vmbr{{ loop.index0 }}
iface vmbr{{ loop.index0 }} inet static
    address {{ ip }}
    netmask 255.255.255.0
    bridge_ports none
    bridge_stp off
    bridge_maxwait 0
    bridge_fd 0
{% endfor %}
